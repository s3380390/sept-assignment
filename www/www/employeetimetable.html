<?php 
	session_start();
	include_once("../lib/JSONHandler.php");
	$jh = new JSONHandler();

	// testing variables
	$empdatabase = $jh->getFileContents("../database/employees.json");
	$employees = [];
	
	foreach ($empdatabase as $emprecord)
	{
		if ($emprecord["company"] == $_SESSION["UserName"])
		{
			array_push($employees, $emprecord);
		}
	}
?>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Employee Timetables</title>
		<link rel="stylesheet" type="text/css" href="styles/style.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	</head>
	<div id="header" style="height:20px;">
	</div>
	<a href="OwnerHome.html">Back to owner page</a>
	<div class="container">
		<div class="div50"></div>
		<div class="daylegend">
			<div class="legenditem" >Legend</div>
			<div class="legenditem">
				<div class="rostered">Rostered</div>
			</div>
			<div class="legenditem">
				<div class="booked">Booked</div>
			</div>
			<div class="legenditem">
				<div class="free">Free</div>
			</div>
			<div class="clearfix"></div>
		</div>
		<div class="clearfix"><h2>Pick an employee:</h2></div>
		<div class="clearfix tabbar">
			<?php 
				$i = 0;
				foreach ($employees as $employee)
				{
					echo("<button class=\"tabbutton\" onclick=\"openEmployee(" . $i . ")\">" . $employee["name"] . "</button>");
					$i++;
				}
				if (count($employees) == 0){
					echo("You have no workers to display");
				}
			?>
			
			<div class="clearfix"></div>
		</div>
		<div class ="tabpane" style="width:100%">
			<div class="container">
				<div class="clearfix daygroup">
					<div class="daybox">
						<label>Day</label>
					</div>
					<div class="daybox">
						<label>Morning (9am - 11am)</label>
					</div>
					<div class="daybox">
						<label>Midday (11am - 1pm)</label>
					</div>
					<div class="daybox">
						<label>Afternoon (1pm - 3pm)</label>
					</div>
					<div class="daybox">
						<label>Night (3pm - 5pm)</label>
					</div>
				</div>	
				<?php
					$i = 0;
					foreach ($employees as $employee) {
						echo("<div id=\"" . $i . "\"class=\"clearfix employeegroup\">");
						$i++;
						
						foreach ($employee["workingtimes"] as $key => $workingtime){
							
							echo("<div class=\"clearfix daygroup\">");
							echo("<div class=\"daybox\"><label>". ucfirst($key) ."</label></div>");
							
							foreach ($workingtime as $wt){
								
								if ($wt["booked"] == true){
									$day = "booked";
								}
								elseif ($wt["working"] == true){
									$day = "rostered";
								}
								else {
									$day = "free";
								}
								
								echo("<div class=\"daybox\"><div class=\"work " . $day . "\"></div></div>");
							}
							
							echo("</div>");
						}
						echo("</div>");
					}
				?>
			</div>
		</div>
	</div>
</html>
<script>
	function openEmployee(employee) {
		// Declare all variables
		var i, tabcontent;
		
		tabcontent = document.getElementsByClassName("employeegroup");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		// Show the current tab, and add an "active" class to the button that opened the tab
		console.log("opening employee: " + employee);
		document.getElementById(employee).style.display = "block";
	}
</script>
